import tkinter as tk
from tkinter import ttk, messagebox, simpledialog
import sqlite3
import webbrowser
import os

DB_FILE = "lojas.db"

# ------------------- Banco de Dados -------------------
def criar_db():
    conn = sqlite3.connect(DB_FILE)
    cursor = conn.cursor()
    cursor.execute("""
        CREATE TABLE IF NOT EXISTS lojas (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            nome TEXT UNIQUE,
            link TEXT
        )
    """)
    conn.commit()
    conn.close()

# ------------------- Funções -------------------
def adicionar_loja():
    nome = simpledialog.askstring("Adicionar Loja", "Digite o nome da loja:")
    if not nome:
        return

    link = simpledialog.askstring("Adicionar Link", "Digite o link da loja:")
    if not link:
        return

    try:
        conn = sqlite3.connect(DB_FILE)
        cursor = conn.cursor()
        cursor.execute("INSERT INTO lojas (nome, link) VALUES (?, ?)", (nome, link))
        conn.commit()
        conn.close()
        carregar_lojas()
        messagebox.showinfo("Sucesso", "Loja adicionada com sucesso!")
    except sqlite3.IntegrityError:
        messagebox.showerror("Erro", "Já existe uma loja com esse nome!")

def editar_loja():
    selected = lista_lojas.selection()
    if not selected:
        messagebox.showwarning("Aviso", "Selecione uma loja para editar.")
        return

    item = lista_lojas.item(selected[0])
    loja_id, nome_atual, link_atual = item["values"]

    novo_nome = simpledialog.askstring("Editar Loja", "Novo nome:", initialvalue=nome_atual)
    novo_link = simpledialog.askstring("Editar Link", "Novo link:", initialvalue=link_atual)

    if novo_nome and novo_link:
        conn = sqlite3.connect(DB_FILE)
        cursor = conn.cursor()
        cursor.execute("UPDATE lojas SET nome = ?, link = ? WHERE id = ?", (novo_nome, novo_link, loja_id))
        conn.commit()
        conn.close()
        carregar_lojas()
        messagebox.showinfo("Sucesso", "Loja atualizada!")

def remover_loja():
    selected = lista_lojas.selection()
    if not selected:
        messagebox.showwarning("Aviso", "Selecione uma loja para remover.")
        return

    item = lista_lojas.item(selected[0])
    loja_id, nome, _ = item["values"]

    if messagebox.askyesno("Confirmar", f"Excluir '{nome}'?"):
        conn = sqlite3.connect(DB_FILE)
        cursor = conn.cursor()
        cursor.execute("DELETE FROM lojas WHERE id = ?", (loja_id,))
        conn.commit()
        conn.close()
        carregar_lojas()

def abrir_loja():
    selected = lista_lojas.selection()
    if not selected:
        messagebox.showwarning("Aviso", "Selecione uma loja.")
        return

    link = lista_lojas.item(selected[0])["values"][2]
    webbrowser.open(link)

def carregar_lojas():
    for item in lista_lojas.get_children():
        lista_lojas.delete(item)

    conn = sqlite3.connect(DB_FILE)
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM lojas")
    for loja in cursor.fetchall():
        lista_lojas.insert("", "end", values=loja)
    conn.close()

# ------------------- NOVA FUNÇÃO: Lojas-VNC -------------------
def abrir_lojas_vnc():
    janela = tk.Toplevel(root)
    janela.title("Lojas - VNC")
    janela.geometry("400x300")

    label = tk.Label(janela, text="Aqui vão as lojas VNC", font=("Arial", 14))
    label.pack(pady=20)

    # Aqui você coloca o código do seu módulo ‘lojas-vnc’
    # Pode adicionar botões, lista de lojas, links etc.

# ------------------- Interface -------------------
root = tk.Tk()
root.title("Gerenciador de Lojas")
root.geometry("600x400")

# Botão Lojas-VNC (NOVO)
btn_vnc = tk.Button(root, text="Lojas-VNC", command=abrir_lojas_vnc, bg="#0055aa", fg="white", height=2)
btn_vnc.pack(fill="x")

frame = ttk.Frame(root)
frame.pack(fill="both", expand=True, padx=10, pady=10)

lista_lojas = ttk.Treeview(frame, columns=("ID", "Nome", "Link"), show="headings")
lista_lojas.heading("ID", text="ID")
lista_lojas.heading("Nome", text="Nome")
lista_lojas.heading("Link", text="Link")
lista_lojas.pack(fill="both", expand=True)

btn_frame = ttk.Frame(root)
btn_frame.pack(pady=10)

ttk.Button(btn_frame, text="Adicionar Loja", command=adicionar_loja).grid(row=0, column=0, padx=5)
ttk.Button(btn_frame, text="Editar Loja", command=editar_loja).grid(row=0, column=1, padx=5)
ttk.Button(btn_frame, text="Remover Loja", command=remover_loja).grid(row=0, column=2, padx=5)
ttk.Button(btn_frame, text="Abrir Loja", command=abrir_loja).grid(row=0, column=3, padx=5)

criar_db()
carregar_lojas()

root.mainloop()
